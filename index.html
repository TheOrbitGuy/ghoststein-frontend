<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>GHOSTSTEIN Aviator</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800;900&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0d0d12;
      --panel: #16161f;
      --card: #1e1e2a;
      --border: rgba(255,255,255,0.07);
      --red: #e63946;
      --red2: #ff6b35;
      --green: #2dc653;
      --gold: #f4c430;
      --ghost: #b388ff;
      --text: #ffffff;
      --sub: rgba(255,255,255,0.45);
    }
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    html, body { height:100%; background:var(--bg); color:var(--text); font-family:'Inter',sans-serif; overflow-x:hidden; }

    /* â”€â”€ TOP BAR â”€â”€ */
    .topbar {
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 14px; background:var(--panel);
      border-bottom:1px solid var(--border);
    }
    .topbar-logo {
      font-family:'Montserrat',sans-serif; font-weight:900; font-size:20px;
      background:linear-gradient(135deg,#e63946,#ff6b35,#f4c430);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      display:flex; align-items:center; gap:6px;
    }
    .topbar-balance {
      font-family:'Montserrat',sans-serif; font-weight:800; font-size:16px; color:var(--green);
    }
    .topbar-right { display:flex; gap:10px; align-items:center; }
    .icon-btn { background:rgba(255,255,255,0.08); border:none; border-radius:8px; padding:7px 10px; color:var(--sub); cursor:pointer; font-size:16px; }

    /* â”€â”€ HISTORY ROW â”€â”€ */
    .history-row {
      display:flex; gap:6px; padding:8px 12px; overflow-x:auto;
      background:var(--panel); border-bottom:1px solid var(--border);
      scrollbar-width:none;
    }
    .history-row::-webkit-scrollbar { display:none; }
    .hist-badge {
      flex-shrink:0; padding:4px 10px; border-radius:20px;
      font-family:'Montserrat',sans-serif; font-weight:700; font-size:12px;
      white-space:nowrap;
    }
    .hist-badge.low  { background:rgba(99,179,237,0.15); color:#63b3ed; border:1px solid rgba(99,179,237,0.3); }
    .hist-badge.mid  { background:rgba(246,173,85,0.15); color:#f6ad55; border:1px solid rgba(246,173,85,0.3); }
    .hist-badge.high { background:rgba(154,44,250,0.2);  color:#c084fc; border:1px solid rgba(154,44,250,0.4); }

    /* â”€â”€ GAME CANVAS â”€â”€ */
    .game-canvas {
      position:relative; width:100%;
      height:min(56vw, 280px);
      background:#0b0b14; overflow:hidden;
    }

    .rays {
      position:absolute; inset:0; pointer-events:none;
      background: conic-gradient(
        from 200deg at 10% 100%,
        transparent 0deg, rgba(255,255,255,0.018) 3deg, transparent 6deg,
        transparent 9deg, rgba(255,255,255,0.012) 12deg, transparent 15deg,
        transparent 18deg, rgba(255,255,255,0.018) 21deg, transparent 24deg,
        transparent 30deg, rgba(255,255,255,0.010) 33deg, transparent 36deg,
        transparent 42deg, rgba(255,255,255,0.015) 45deg, transparent 48deg,
        transparent 54deg, rgba(255,255,255,0.010) 57deg, transparent 60deg,
        transparent 66deg, rgba(255,255,255,0.018) 69deg, transparent 72deg,
        transparent 90deg
      );
    }

    .grid-y {
      position:absolute; inset:0; pointer-events:none;
      display:flex; flex-direction:column; justify-content:space-between; padding:8px 0;
    }
    .grid-line { width:100%; height:1px; background:rgba(255,255,255,0.04); }

    .graph-svg { position:absolute; inset:0; width:100%; height:100%; pointer-events:none; }

    .ghost-watermark {
      position:absolute; bottom:8px; left:50%; transform:translateX(-50%);
      width:min(22vw, 110px); opacity:0.10; pointer-events:none;
      user-select:none; animation:ghost-bob 2s ease-in-out infinite alternate;
    }

    @keyframes ghost-float-watermark {
      0%,100% { transform:translateX(-50%) translateY(0px); }
      50%     { transform:translateX(-50%) translateY(-8px); }
    }

    @keyframes ghost-eye-blink {
      0%,88%,100% { transform:scaleY(1); transform-origin:center; }
      94%         { transform:scaleY(0.08); transform-origin:center; }
    }
    @keyframes ghost-tail-l {
      0%,100% { d:path("M2 22 Q0 27 3 28 Q6 29 7 25"); }
      50%     { d:path("M2 22 Q-1 28 2 30 Q5 31 7 25"); }
    }
    @keyframes ghost-tail-m {
      0%,100% { d:path("M10 24 Q10 29 13 29 Q16 29 16 24"); }
      50%     { d:path("M10 24 Q9 30 13 31 Q17 30 16 24"); }
    }
    @keyframes ghost-tail-r {
      0%,100% { d:path("M19 25 Q20 29 23 28 Q26 27 24 22"); }
      50%     { d:path("M19 25 Q21 31 24 30 Q27 28 24 22"); }
    }

    .mult-wrap {
      position:absolute; top:50%; left:50%; transform:translate(-50%,-55%);
      text-align:center; pointer-events:none; z-index:10;
    }
    .mult-value {
      font-family:'Montserrat',sans-serif; font-weight:900;
      font-size:min(14vw,70px); line-height:1;
      transition:color 0.2s;
    }
    .mult-value.idle    { color:rgba(255,255,255,0.25); }
    .mult-value.flying  { color:#fff; text-shadow:0 0 30px rgba(255,255,255,0.4); }
    .mult-value.won     { color:var(--green); text-shadow:0 0 30px rgba(45,198,83,0.6); }
    .mult-value.crashed { color:var(--red);   text-shadow:0 0 30px rgba(230,57,70,0.6); }

    .mult-label {
      font-size:12px; color:var(--sub); letter-spacing:2px;
      text-transform:uppercase; margin-top:4px;
    }
    .mult-label.countdown { color:var(--gold); font-size:13px; font-weight:600; }
    .mult-label.crashed   { color:var(--red); }
    .mult-label.won       { color:var(--green); }

    .plane-wrap {
      position:absolute; z-index:20;
      transition:none; pointer-events:none;
    }
    .plane-ghost {
      position:absolute; top:-34px; left:50%; transform:translateX(-50%);
      width:30px; height:30px;
      animation:ghost-bob 1s ease-in-out infinite alternate;
      filter:drop-shadow(0 0 6px rgba(179,136,255,0.9));
    }
    @keyframes ghost-bob {
      from { transform:translateX(-50%) translateY(0px); }
      to   { transform:translateX(-50%) translateY(-6px); }
    }

    .plane-svg {
      width:min(22vw,100px); height:auto;
      filter:drop-shadow(0 0 8px rgba(230,57,70,0.6)) drop-shadow(0 2px 14px rgba(230,57,70,0.3));
    }
    .prop-spin {
      transform-origin: 88px 30px;
      animation: prop-spin 0.1s linear infinite;
    }
    @keyframes prop-spin {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }
    .exhaust-wrap {
      position:absolute; right:-8px; top:50%; transform:translateY(-50%);
      pointer-events:none;
    }
    .exhaust-dot {
      width:5px; height:5px; border-radius:50%;
      background:rgba(180,180,200,0.4);
      position:absolute; top:0; left:0;
      animation: exhaust-float 0.5s ease-out infinite;
    }
    .exhaust-dot:nth-child(2){ animation-delay:0.17s; }
    .exhaust-dot:nth-child(3){ animation-delay:0.34s; }
    @keyframes exhaust-float {
      0%  { transform:translateX(0)    scale(0.5); opacity:0.5; }
      100%{ transform:translateX(20px) scale(2);   opacity:0; }
    }

    .trail-svg { position:absolute; inset:0; width:100%; height:100%; pointer-events:none; z-index:5; }

    .crash-flash {
      position:absolute; inset:0; background:rgba(230,57,70,0.15);
      pointer-events:none; opacity:0; z-index:25;
      animation:none;
    }
    .crash-flash.show { animation:flash 0.4s ease-out forwards; }
    @keyframes flash { 0%{opacity:1} 100%{opacity:0} }

    /* â”€â”€ BOTTOM PANEL â”€â”€ */
    .bottom { background:var(--bg); padding:10px 12px 20px; }

    .quick-amounts {
      display:grid; grid-template-columns:repeat(4,1fr); gap:6px; margin-bottom:10px;
    }
    .qa-btn {
      background:var(--card); border:1px solid var(--border); border-radius:8px;
      padding:8px 0; font-family:'Montserrat',sans-serif; font-weight:700; font-size:13px;
      color:var(--sub); cursor:pointer; transition:all 0.15s; text-align:center;
    }
    .qa-btn:active, .qa-btn.active { background:rgba(230,57,70,0.2); border-color:var(--red); color:#fff; }

    .bet-row {
      display:flex; gap:10px; align-items:center; margin-bottom:10px;
    }
    .bet-ctrl {
      display:flex; align-items:center; background:var(--card);
      border:1px solid var(--border); border-radius:12px; overflow:hidden; flex:1;
    }
    .bet-adj {
      width:42px; height:52px; background:rgba(255,255,255,0.05);
      border:none; color:var(--sub); font-size:22px; cursor:pointer;
      display:flex; align-items:center; justify-content:center; flex-shrink:0;
    }
    .bet-adj:active { background:rgba(255,255,255,0.12); }
    .bet-input {
      flex:1; background:transparent; border:none; outline:none;
      color:#fff; font-family:'Montserrat',sans-serif; font-weight:800;
      font-size:22px; text-align:center;
    }
    .bet-input:disabled { opacity:0.5; }

    .action-btn {
      width:100%; padding:16px; border:none; border-radius:14px;
      font-family:'Montserrat',sans-serif; font-weight:900; font-size:18px;
      color:#fff; cursor:pointer; letter-spacing:0.5px; position:relative;
      overflow:hidden; transition:opacity 0.2s, transform 0.1s;
      touch-action:manipulation;
    }
    .action-btn:active { transform:scale(0.98); }
    .action-btn:disabled { cursor:not-allowed; opacity:0.7; }

    .action-btn.bet-state {
      background:linear-gradient(135deg,#2dc653,#22a844);
      box-shadow:0 4px 24px rgba(45,198,83,0.4);
    }
    .action-btn.cashout-state {
      background:linear-gradient(135deg,#e63946,#c1121f);
      box-shadow:0 4px 24px rgba(230,57,70,0.5);
      animation:cashout-pulse 0.6s ease-in-out infinite alternate;
    }
    @keyframes cashout-pulse {
      from{box-shadow:0 4px 20px rgba(230,57,70,0.4)}
      to{box-shadow:0 4px 40px rgba(230,57,70,0.8),0 0 60px rgba(230,57,70,0.2)}
    }
    .action-btn.countdown-state {
      background:linear-gradient(135deg,#374151,#4b5563);
      box-shadow:none;
    }

    .btn-sub { font-size:12px; font-weight:600; opacity:0.8; display:block; margin-top:2px; letter-spacing:1px; }

    .dw-row { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:10px; }
    .dw-btn {
      padding:12px; border:none; border-radius:12px;
      font-family:'Montserrat',sans-serif; font-weight:700; font-size:14px;
      color:#fff; cursor:pointer; transition:all 0.2s;
    }
    .dw-btn.dep { background:rgba(45,198,83,0.2); border:1px solid rgba(45,198,83,0.3); color:var(--green); }
    .dw-btn.wit { background:rgba(154,44,250,0.2); border:1px solid rgba(154,44,250,0.3); color:var(--ghost); }
    .dw-btn:active { transform:scale(0.96); }

    .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); backdrop-filter:blur(6px); z-index:100; align-items:flex-end; justify-content:center; }
    .modal.open { display:flex; }
    .modal-sheet {
      background:var(--panel); border-radius:20px 20px 0 0;
      padding:24px 20px 36px; width:100%; max-width:500px;
      border-top:1px solid var(--border);
    }
    .modal-title { font-family:'Montserrat',sans-serif; font-weight:800; font-size:18px; margin-bottom:16px; }
    .modal-input {
      width:100%; background:var(--card); border:1px solid var(--border);
      border-radius:12px; padding:16px; color:#fff;
      font-family:'Montserrat',sans-serif; font-weight:700; font-size:22px;
      outline:none; margin-bottom:14px;
    }
    .modal-btns { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .modal-cancel {
      background:rgba(255,255,255,0.08); border:1px solid var(--border);
      border-radius:12px; padding:14px; color:var(--sub);
      font-family:'Montserrat',sans-serif; font-weight:700; font-size:15px; cursor:pointer;
    }
    .modal-ok {
      border:none; border-radius:12px; padding:14px; color:#fff;
      font-family:'Montserrat',sans-serif; font-weight:800; font-size:15px; cursor:pointer;
    }
    .modal-ok.dep { background:linear-gradient(135deg,#2dc653,#22a844); }
    .modal-ok.wit { background:linear-gradient(135deg,#7c3aed,#9333ea); }
  </style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
  <div class="topbar-logo">ðŸ‘» GHOSTSTEIN</div>
  <div class="topbar-balance" id="topbar-balance">0.00</div>
  <div class="topbar-right">
    <button class="icon-btn">â‰¡</button>
  </div>
</div>

<!-- HISTORY ROW -->
<div class="history-row" id="history-row">
  <div class="hist-badge low">1.00x</div>
</div>

<!-- GAME CANVAS -->
<div class="game-canvas" id="game-canvas">
  <div class="rays"></div>
  <div class="grid-y">
    <div class="grid-line"></div>
    <div class="grid-line"></div>
    <div class="grid-line"></div>
    <div class="grid-line"></div>
    <div class="grid-line"></div>
  </div>
  <!-- Ghost watermark - animated SVG cartoon -->
  <div class="ghost-watermark" style="animation:ghost-float-watermark 3s ease-in-out infinite;">
    <svg viewBox="0 0 28 32" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:100%;">
      <path d="M14 2 Q4 2 3 12 Q2 18 4 22 Q2 27 5 28 Q8 29 8 25 Q10 28 13 28 Q16 28 16 24 Q17 27 20 28 Q23 29 23 25 Q26 27 24 22 Q26 18 25 12 Q24 2 14 2 Z"
        fill="rgba(179,136,255,0.9)" stroke="rgba(220,200,255,0.6)" stroke-width="0.5"/>
      <ellipse cx="10" cy="13" rx="3" ry="3.5" fill="white"/>
      <ellipse cx="18" cy="13" rx="3" ry="3.5" fill="white"/>
      <ellipse cx="10.5" cy="13.5" rx="1.5" ry="1.8" fill="#4a0080" style="animation:ghost-eye-blink 3s ease-in-out infinite;"/>
      <ellipse cx="18.5" cy="13.5" rx="1.5" ry="1.8" fill="#4a0080" style="animation:ghost-eye-blink 3s ease-in-out infinite;"/>
      <circle cx="9.5" cy="12.2" r="0.6" fill="white" opacity="0.9"/>
      <circle cx="17.5" cy="12.2" r="0.6" fill="white" opacity="0.9"/>
      <path d="M10 19 Q14 22 18 19" fill="none" stroke="rgba(100,0,150,0.6)" stroke-width="1" stroke-linecap="round"/>
      <ellipse cx="7.5" cy="17" rx="2" ry="1.2" fill="rgba(255,150,200,0.35)"/>
      <ellipse cx="20.5" cy="17" rx="2" ry="1.2" fill="rgba(255,150,200,0.35)"/>
    </svg>
  </div>

  <svg class="trail-svg" id="trail-svg">
    <defs>
      <linearGradient id="tg" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:rgba(230,57,70,0);"/>
        <stop offset="60%" style="stop-color:rgba(230,57,70,0.6);"/>
        <stop offset="100%" style="stop-color:rgba(255,107,53,0.9);"/>
      </linearGradient>
      <linearGradient id="area-grad" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" style="stop-color:#e63946;stop-opacity:0.5"/>
        <stop offset="100%" style="stop-color:#e63946;stop-opacity:0"/>
      </linearGradient>
    </defs>
    <polyline id="trail-path" points="" fill="none" stroke="url(#tg)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
    <polygon id="trail-fill" points="" fill="url(#area-grad)" opacity="0.15"/>
  </svg>

  <svg class="graph-svg" id="graph-svg">
    <g id="y-dots"></g>
  </svg>

  <div class="plane-wrap" id="plane-wrap" style="left:20px;bottom:20px;">
    <div style="position:relative;display:inline-block;">
      <div class="plane-ghost" id="plane-ghost">
        <svg viewBox="0 0 28 32" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:100%;">
          <!-- Glow -->
          <ellipse cx="14" cy="16" rx="13" ry="15" fill="rgba(179,136,255,0.15)"/>
          <!-- Body -->
          <path d="M14 2 Q4 2 3 12 Q2 18 4 22 Q2 27 5 28 Q8 29 8 25 Q10 28 13 28 Q16 28 16 24 Q17 27 20 28 Q23 29 23 25 Q26 27 24 22 Q26 18 25 12 Q24 2 14 2 Z"
            fill="rgba(210,180,255,0.95)" stroke="rgba(255,255,255,0.5)" stroke-width="0.6"/>
          <!-- Body highlight -->
          <path d="M14 3 Q8 4 6 9 Q5 13 6 16 Q9 8 14 7 Q19 8 22 16 Q23 13 22 9 Q20 4 14 3 Z"
            fill="rgba(255,255,255,0.25)"/>
          <!-- Left eye white -->
          <ellipse cx="10" cy="13" rx="3.2" ry="3.8" fill="white"/>
          <!-- Right eye white -->
          <ellipse cx="18" cy="13" rx="3.2" ry="3.8" fill="white"/>
          <!-- Left pupil -->
          <ellipse cx="10.6" cy="13.6" rx="1.6" ry="2" fill="#3d006b" style="animation:ghost-eye-blink 2.5s ease-in-out infinite;"/>
          <!-- Right pupil -->
          <ellipse cx="18.6" cy="13.6" rx="1.6" ry="2" fill="#3d006b" style="animation:ghost-eye-blink 2.5s ease-in-out infinite 0.1s;"/>
          <!-- Left shine -->
          <circle cx="9.6" cy="12" r="0.7" fill="white"/>
          <!-- Right shine -->
          <circle cx="17.6" cy="12" r="0.7" fill="white"/>
          <!-- Smile -->
          <path d="M10.5 19.5 Q14 23 17.5 19.5" fill="none" stroke="rgba(80,0,120,0.7)" stroke-width="1.2" stroke-linecap="round"/>
          <!-- Blush left -->
          <ellipse cx="7" cy="17.5" rx="2.2" ry="1.3" fill="rgba(255,130,190,0.4)"/>
          <!-- Blush right -->
          <ellipse cx="21" cy="17.5" rx="2.2" ry="1.3" fill="rgba(255,130,190,0.4)"/>
          <!-- Little sparkle -->
          <circle cx="23" cy="6" r="0.8" fill="rgba(255,255,255,0.8)" style="animation:ghost-eye-blink 1.8s ease-in-out infinite 0.5s;"/>
          <circle cx="5" cy="8" r="0.5" fill="rgba(255,255,255,0.6)" style="animation:ghost-eye-blink 2.2s ease-in-out infinite 1s;"/>
        </svg>
      </div>
      <div style="position:relative;display:inline-flex;align-items:center;">
        <!-- Exhaust smoke from tail -->
        <div class="exhaust-wrap">
          <div class="exhaust-dot"></div>
          <div class="exhaust-dot"></div>
          <div class="exhaust-dot"></div>
        </div>
        <!-- Propeller Aviator Plane -->
        <svg class="plane-svg" id="jet-svg" viewBox="0 0 110 60" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="body-grad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stop-color="#ff4444"/>
              <stop offset="45%" stop-color="#cc0000"/>
              <stop offset="100%" stop-color="#880000"/>
            </linearGradient>
            <linearGradient id="wing-grad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#991111"/>
              <stop offset="100%" stop-color="#cc2222"/>
            </linearGradient>
            <linearGradient id="glass-grad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="rgba(160,220,255,0.9)"/>
              <stop offset="100%" stop-color="rgba(60,130,200,0.6)"/>
            </linearGradient>
          </defs>

          <!-- TAIL FINS -->
          <path d="M8 30 L2 18 L14 27 Z" fill="#aa1111"/>
          <path d="M8 30 L2 42 L14 33 Z" fill="#881111"/>
          <!-- Small top tail fin -->
          <path d="M10 28 L6 20 L15 26 Z" fill="#bb1111"/>

          <!-- MAIN FUSELAGE â€” classic rounded prop plane body -->
          <path d="M10 30 Q12 22 30 24 Q55 20 75 25 Q88 27 95 30 Q88 33 75 35 Q55 40 30 36 Q12 38 10 30 Z"
                fill="url(#body-grad)"/>

          <!-- UPPER WING (main) -->
          <path d="M35 24 Q38 14 55 16 Q62 17 65 22 Q55 21 38 26 Z" fill="url(#wing-grad)"/>
          <path d="M35 24 Q28 10 20 8 Q30 12 38 22 Z" fill="#881111"/>

          <!-- LOWER WING -->
          <path d="M35 36 Q38 46 55 44 Q62 43 65 38 Q55 39 38 34 Z" fill="url(#wing-grad)"/>
          <path d="M35 36 Q28 50 20 52 Q30 48 38 38 Z" fill="#881111"/>

          <!-- Wing stripes / detail -->
          <line x1="42" y1="21" x2="55" y2="18" stroke="rgba(255,150,150,0.3)" stroke-width="1"/>
          <line x1="42" y1="39" x2="55" y2="42" stroke="rgba(255,150,150,0.3)" stroke-width="1"/>

          <!-- COCKPIT / CANOPY -->
          <ellipse cx="72" cy="26" rx="12" ry="6" fill="url(#glass-grad)" stroke="rgba(255,180,180,0.5)" stroke-width="0.6"/>
          <ellipse cx="70" cy="24" rx="5" ry="2.5" fill="rgba(255,255,255,0.3)"/>

          <!-- FUSELAGE STRIPE -->
          <path d="M30 28 Q60 26 88 29 Q88 31 60 32 Q30 33 30 30 Z" fill="rgba(255,255,255,0.10)"/>

          <!-- NOSE CONE -->
          <path d="M93 28 Q100 29 107 30 Q100 31 93 32 Z" fill="#ff5555"/>

          <!-- ENGINE COWL (circle at nose) -->
          <ellipse cx="91" cy="30" rx="5" ry="5.5" fill="#cc1111" stroke="#ff3333" stroke-width="0.8"/>
          <ellipse cx="91" cy="30" rx="3" ry="3.5" fill="#ff4444"/>

          <!-- PROPELLER (spinning group) -->
          <g class="prop-spin" id="prop-group">
            <!-- Blade 1 (vertical) -->
            <path d="M89 30 Q87 18 89 14 Q91 18 89 30 Z" fill="rgba(40,40,40,0.9)" stroke="rgba(80,80,80,0.5)" stroke-width="0.4"/>
            <!-- Blade 2 (vertical down) -->
            <path d="M89 30 Q87 42 89 46 Q91 42 89 30 Z" fill="rgba(40,40,40,0.9)" stroke="rgba(80,80,80,0.5)" stroke-width="0.4"/>
            <!-- Hub center -->
            <circle cx="89" cy="30" r="2.2" fill="#333" stroke="#555" stroke-width="0.5"/>
            <circle cx="89" cy="30" r="1" fill="#666"/>
          </g>

          <!-- Rivets -->
          <circle cx="50" cy="27" r="0.8" fill="rgba(255,200,200,0.25)"/>
          <circle cx="62" cy="27" r="0.8" fill="rgba(255,200,200,0.25)"/>
          <circle cx="75" cy="28" r="0.8" fill="rgba(255,200,200,0.25)"/>
        </svg>
      </div>
    </div>
  </div>

  <div class="mult-wrap">
    <div class="mult-value idle" id="mult-value">1.00x</div>
    <div class="mult-label" id="mult-label">Waiting for bets...</div>
  </div>

  <div class="crash-flash" id="crash-flash"></div>
</div>

<!-- BOTTOM PANEL -->
<div class="bottom">
  <div class="quick-amounts">
    <button class="qa-btn" onclick="setQuick(100)">100</button>
    <button class="qa-btn" onclick="setQuick(500)">500</button>
    <button class="qa-btn" onclick="setQuick(1000)">1,000</button>
    <button class="qa-btn" onclick="setQuick(5000)">5,000</button>
  </div>

  <div class="bet-row">
    <div class="bet-ctrl">
      <button class="bet-adj" id="bet-minus" onclick="adjustBet(-50)">âˆ’</button>
      <input class="bet-input" type="number" id="bet-input" value="100" min="1"/>
      <button class="bet-adj" id="bet-plus" onclick="adjustBet(50)">+</button>
    </div>
  </div>

  <button class="action-btn bet-state" id="action-btn" onclick="handleAction()">
    BET
    <span class="btn-sub" id="btn-sub">100 $GHOSTSTEIN</span>
  </button>

  <div class="dw-row">
    <button class="dw-btn dep" onclick="openModal('deposit')">â¬‡ Deposit</button>
    <button class="dw-btn wit" onclick="openModal('withdraw')">â¬† Withdraw</button>
  </div>
</div>

<!-- Deposit Modal -->
<div class="modal" id="deposit-modal">
  <div class="modal-sheet">
    <div class="modal-title">â¬‡ Deposit $GHOSTSTEIN</div>
    <input class="modal-input" type="number" id="dep-input" placeholder="Enter amount"/>
    <div class="modal-btns">
      <button class="modal-cancel" onclick="closeModal('deposit')">Cancel</button>
      <button class="modal-ok dep" onclick="doDeposit()">Deposit</button>
    </div>
  </div>
</div>

<!-- Withdraw Modal -->
<div class="modal" id="withdraw-modal">
  <div class="modal-sheet">
    <div class="modal-title">â¬† Withdraw $GHOSTSTEIN</div>
    <input class="modal-input" type="number" id="wit-input" placeholder="Enter amount"/>
    <div class="modal-btns">
      <button class="modal-cancel" onclick="closeModal('withdraw')">Cancel</button>
      <button class="modal-ok wit" onclick="doWithdraw()">Withdraw</button>
    </div>
  </div>
</div>

<script>
  const BACKEND = 'https://ghoststein-backend1-production.up.railway.app';

  // ============================================================
  // âœ… FIX 1: UNIQUE USER ID PER BROWSER
  // Every browser/device gets its own ID stored in localStorage.
  // Telegram users get their real Telegram ID as before.
  // ============================================================
  function getOrCreateUserId() {
    // First check Telegram
    if (window.Telegram?.WebApp?.initDataUnsafe?.user?.id) {
      return window.Telegram.WebApp.initDataUnsafe.user.id.toString();
    }
    // Otherwise use a persistent browser ID
    let id = localStorage.getItem('ghoststein_uid');
    if (!id) {
      id = 'user_' + Date.now() + '_' + Math.random().toString(36).slice(2, 9);
      localStorage.setItem('ghoststein_uid', id);
    }
    return id;
  }

  // â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let balance    = 0;
  let userId     = 'temp';   // set properly in window.onload
  let state      = 'waiting';
  let mult       = 1.00;
  let crashAt    = 2.00;
  let gameId     = null;
  let betAmt     = 100;
  let currentBet = 0;
  let animID     = null;
  let cntID      = null;
  let isBusy     = false;
  let startMs    = 0;
  let wobble     = 0;
  let trailPts   = [];
  let histData   = [];

  const canvas = document.getElementById('game-canvas');

  // â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  window.onload = () => {
    if (window.Telegram?.WebApp) {
      window.Telegram.WebApp.ready();
      window.Telegram.WebApp.expand();
    }
    // âœ… Set unique userId
    userId = getOrCreateUserId();
    loadBalance();
    updateBtnSub();
    document.getElementById('bet-input').addEventListener('input', () => {
      betAmt = Math.max(1, parseFloat(document.getElementById('bet-input').value) || 1);
      updateBtnSub();
    });
  };

  async function loadBalance() {
    try {
      const r = await fetch(`${BACKEND}/api/user/${userId}`);
      const d = await r.json();
      if (d.success) balance = d.balance;
    } catch { balance = 0; }
    refreshBalance();
  }

  function refreshBalance() {
    document.getElementById('topbar-balance').textContent = balance.toFixed(2) + ' $G';
  }

  function updateBtnSub() {
    betAmt = Math.max(1, parseFloat(document.getElementById('bet-input').value) || 1);
    document.getElementById('btn-sub').textContent = betAmt.toFixed(2) + ' $GHOSTSTEIN';
  }

  // â”€â”€ BET ADJUST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function adjustBet(delta) {
    if (state !== 'waiting') return;
    const input = document.getElementById('bet-input');
    betAmt = Math.max(1, (parseFloat(input.value) || 0) + delta);
    input.value = betAmt;
    updateBtnSub();
  }

  function setQuick(val) {
    if (state !== 'waiting') return;
    document.getElementById('bet-input').value = val;
    betAmt = val;
    updateBtnSub();
    document.querySelectorAll('.qa-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    setTimeout(() => event.target.classList.remove('active'), 300);
  }

  // â”€â”€ BULLETPROOF BUTTON LOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let actionLocked = false;
  let lastActionTime = 0;
  const MIN_GAP = 800;

  function canAct() {
    if (actionLocked) return false;
    if (isBusy) return false;
    if (Date.now() - lastActionTime < MIN_GAP) return false;
    return true;
  }
  function lockAction()   { actionLocked = true; lastActionTime = Date.now(); }
  function unlockAction() { actionLocked = false; }

  // â”€â”€ MAIN ACTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function handleAction() {
    if (!canAct()) return;
    if (state === 'waiting') startGame();
    else if (state === 'flying') cashOut();
  }

  // â”€â”€ START GAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function startGame() {
    if (state !== 'waiting') return;

    betAmt = Math.max(1, parseFloat(document.getElementById('bet-input').value) || 1);
    if (betAmt > balance) return alert('Not enough balance!');

    lockAction();
    isBusy = true;
    currentBet = betAmt;

    if (animID) { clearInterval(animID); animID = null; }
    if (cntID)  { clearInterval(cntID);  cntID  = null; }

    try {
      const r = await fetch(`${BACKEND}/api/game/start`, {
        method: 'POST', headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ userId, betAmount: betAmt })
      });
      const d = await r.json();
      if (!d.success) {
        isBusy = false;
        unlockAction();
        return alert(d.error);
      }
      balance = d.balance;
      gameId  = d.gameId;
      crashAt = Math.min(d.crashPoint || fairCrash(), 20);
    } catch {
      balance -= betAmt;
      gameId   = Date.now().toString();
      crashAt  = fairCrash();
    }

    refreshBalance();
    isBusy = false;
    unlockAction();
    fly();
  }

  function fairCrash() {
    const r = Math.random();
    if (r < 0.35) return 1.00 + Math.random() * 0.70;
    if (r < 0.60) return 1.70 + Math.random() * 0.80;
    if (r < 0.80) return 2.50 + Math.random() * 2.50;
    if (r < 0.93) return 5.00 + Math.random() * 5.00;
    return 10 + Math.random() * 10;
  }

  // â”€â”€ FLY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function fly() {
    if (animID) { clearInterval(animID); animID = null; }
    if (cntID)  { clearInterval(cntID);  cntID  = null; }

    state    = 'flying';
    mult     = 1.00;
    wobble   = 0;
    trailPts = [];
    startMs  = Date.now();

    document.getElementById('trail-path').setAttribute('points','');
    document.getElementById('trail-fill').setAttribute('points','');

    const pw = document.getElementById('plane-wrap');
    pw.style.left   = '20px';
    pw.style.bottom = '20px';
    document.getElementById('jet-svg').style.transform = 'rotate(0deg)';
    document.getElementById('jet-svg').style.opacity   = '1';
    document.getElementById('plane-ghost').style.display = 'block';
    document.getElementById('crash-flash').classList.remove('show');

    setMult('flying', '1.00x', 'Cash out before it flies away!', '');
    setBtnCashout();
    lockBetControls(true);

    animID = setInterval(tick, 50);
  }

  function tick() {
    const elapsed = (Date.now() - startMs) / 1000;
    mult = parseFloat((1 + elapsed * elapsed * 0.09).toFixed(2));
    if (mult > 20) mult = 20;

    document.getElementById('mult-value').textContent = mult.toFixed(2) + 'x';

    // âœ… FIX 3: Update cashout button amount live every tick
    if (state === 'flying') {
      document.getElementById('btn-sub').textContent =
        (currentBet * mult).toFixed(2) + ' $GHOSTSTEIN';
    }

    const cW = canvas.offsetWidth  || 360;
    const cH = canvas.offsetHeight || 220;
    const progress = Math.min((mult - 1) / Math.max(crashAt - 1, 0.1), 1);

    wobble += 0.06;
    // Gentle bob â€” subtle, not wild
    const bob = Math.sin(wobble * 1.4) * 2.5;

    // âœ… Smooth exponential curve: x linear, y curves upward naturally
    const px = 14 + progress * (cW * 0.78);
    const curveY = Math.pow(progress, 1.7);
    const py = (cH - 44) - curveY * (cH - 72) + bob;

    const pw = document.getElementById('plane-wrap');
    pw.style.left   = px + 'px';
    pw.style.bottom = (cH - py - 26) + 'px';

    // âœ… Tilt follows the climb angle naturally â€” starts level, tilts up as it climbs
    const climbAngle = -Math.min(progress * 24, 22);
    const wobbleTilt = Math.sin(wobble * 1.4) * 1.8;
    document.getElementById('jet-svg').style.transform = `rotate(${climbAngle + wobbleTilt}deg)`;

    trailPts.push({ x: px + 10, y: py + 14 });
    if (trailPts.length > 100) trailPts.shift();

    const pts = trailPts.map(p => `${p.x},${p.y}`).join(' ');
    document.getElementById('trail-path').setAttribute('points', pts);

    if (trailPts.length > 1) {
      const first   = trailPts[0];
      const last    = trailPts[trailPts.length - 1];
      const fillPts = trailPts.map(p => `${p.x},${p.y}`).join(' ')
        + ` ${last.x},${cH} ${first.x},${cH}`;
      document.getElementById('trail-fill').setAttribute('points', fillPts);
    }

    if (mult >= crashAt) doCrash();
  }

  // â”€â”€ CRASH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function doCrash() {
    clearInterval(animID); animID = null;
    state  = 'ended';
    isBusy = false;
    unlockAction();

    document.getElementById('jet-svg').style.opacity    = '0';
    document.getElementById('plane-ghost').style.display = 'none';
    document.getElementById('crash-flash').classList.add('show');

    setMult('crashed', mult.toFixed(2) + 'x', 'ðŸ‘» FLEW AWAY!', 'crashed');
    addHistory(mult.toFixed(2), false);

    // âœ… FIX 2: Tell the backend this game crashed so active state clears
    if (gameId) {
      try {
        await fetch(`${BACKEND}/api/game/crash`, {
          method: 'POST', headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ userId, gameId })
        });
      } catch { /* silent fail â€” backend auto-clears after 60s anyway */ }
    }

    countdown(5);
  }

  // â”€â”€ CASH OUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function cashOut() {
    if (state !== 'flying') return;
    if (!canAct()) return;

    // Stop animation FIRST
    clearInterval(animID); animID = null;

    lockAction();
    isBusy = true;
    state  = 'ended';

    const lockedMult = mult;
    const win = parseFloat((currentBet * lockedMult).toFixed(2));

    setMult('won', lockedMult.toFixed(2) + 'x', `ðŸŽ‰ Won ${win.toFixed(2)}!`, 'won');
    setBtnDisabled('âœ… CASHED OUT!');

    try {
      const r = await fetch(`${BACKEND}/api/game/cashout`, {
        method: 'POST', headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ userId, gameId, multiplier: lockedMult })
      });
      const d = await r.json();
      balance = d.success ? d.balance : balance + win;
    } catch { balance += win; }

    refreshBalance();
    addHistory(lockedMult.toFixed(2), true);
    isBusy = false;
    unlockAction();
    countdown(5);
  }

  // â”€â”€ COUNTDOWN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function countdown(secs) {
    state = 'countdown';
    setBtnCountdown(secs);
    cntID = setInterval(() => {
      secs--;
      if (secs <= 0) {
        clearInterval(cntID); cntID = null;
        resetRound();
      } else {
        setBtnCountdown(secs);
      }
    }, 1000);
  }

  function resetRound() {
    state  = 'waiting';
    mult   = 1.00;
    gameId = null;
    isBusy = false;
    unlockAction();

    document.getElementById('trail-path').setAttribute('points','');
    document.getElementById('trail-fill').setAttribute('points','');
    const pw = document.getElementById('plane-wrap');
    pw.style.left   = '20px';
    pw.style.bottom = '20px';
    document.getElementById('jet-svg').style.opacity = '1';
    document.getElementById('jet-svg').style.transform = 'rotate(0deg)';
    document.getElementById('plane-ghost').style.display = 'block';
    document.getElementById('crash-flash').classList.remove('show');

    setMult('idle', '1.00x', 'Place your bet!', '');
    setBtnBet();
    lockBetControls(false);
  }

  // â”€â”€ UI HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setMult(cls, val, label, labelCls) {
    const mv = document.getElementById('mult-value');
    const ml = document.getElementById('mult-label');
    mv.className   = 'mult-value ' + cls;
    mv.textContent = val;
    ml.className   = 'mult-label ' + labelCls;
    ml.textContent = label;
  }

  function setBtnBet() {
    const b = document.getElementById('action-btn');
    b.className = 'action-btn bet-state';
    b.disabled  = false;
    b.childNodes[0].textContent = 'BET ';
    document.getElementById('btn-sub').textContent = betAmt.toFixed(2) + ' $GHOSTSTEIN';
  }

  function setBtnCashout() {
    const b = document.getElementById('action-btn');
    b.className = 'action-btn cashout-state';
    b.disabled  = false;
    b.childNodes[0].textContent = 'CASH OUT ';
    document.getElementById('btn-sub').textContent = (currentBet * mult).toFixed(2) + ' $GHOSTSTEIN';
  }

  function setBtnDisabled(txt) {
    const b = document.getElementById('action-btn');
    b.className = 'action-btn countdown-state';
    b.disabled  = true;
    b.childNodes[0].textContent = txt + ' ';
    document.getElementById('btn-sub').textContent = '';
  }

  function setBtnCountdown(s) {
    const b = document.getElementById('action-btn');
    b.className = 'action-btn countdown-state';
    b.disabled  = true;
    b.childNodes[0].textContent = `â³ Next bet in ${s}s `;
    document.getElementById('btn-sub').textContent = '';
  }

  function lockBetControls(lock) {
    document.getElementById('bet-input').disabled  = lock;
    document.getElementById('bet-minus').disabled  = lock;
    document.getElementById('bet-plus').disabled   = lock;
  }

  // â”€â”€ HISTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function addHistory(m, won) {
    histData.unshift({ m, won });
    if (histData.length > 12) histData.pop();
    const row = document.getElementById('history-row');
    row.innerHTML = histData.map(h => {
      const v = parseFloat(h.m);
      let cls = v >= 5 ? 'high' : v >= 2 ? 'mid' : 'low';
      return `<div class="hist-badge ${cls}">${h.m}x</div>`;
    }).join('');
  }

  // â”€â”€ MODALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openModal(t)  { document.getElementById(`${t}-modal`).classList.add('open'); }
  function closeModal(t) { document.getElementById(`${t}-modal`).classList.remove('open'); }

  async function doDeposit() {
    const amt = parseFloat(document.getElementById('dep-input').value);
    if (!amt || amt <= 0) return alert('Enter valid amount!');
    try {
      const r = await fetch(`${BACKEND}/api/deposit`, {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ userId, amount: amt })
      });
      const d = await r.json();
      balance = d.success ? d.balance : balance + amt;
    } catch { balance += amt; }
    refreshBalance();
    closeModal('deposit');
    document.getElementById('dep-input').value = '';
    alert(`âœ… Deposited ${amt} $GHOSTSTEIN!`);
  }

  async function doWithdraw() {
    const amt = parseFloat(document.getElementById('wit-input').value);
    if (!amt || amt <= 0) return alert('Enter valid amount!');
    if (amt > balance)   return alert('Insufficient balance!');
    try {
      const r = await fetch(`${BACKEND}/api/withdraw`, {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ userId, amount: amt })
      });
      const d = await r.json();
      balance = d.success ? d.balance : balance - amt;
    } catch { balance -= amt; }
    refreshBalance();
    closeModal('withdraw');
    document.getElementById('wit-input').value = '';
    alert(`âœ… Withdrew ${amt} $GHOSTSTEIN!`);
  }
</script>
</body>
</html>
